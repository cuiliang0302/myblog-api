# nps代理
server {
    listen 443 ssl http2;
    server_name  nps.cuiliangblog.cn;
    charset utf-8;
    ssl_certificate    /opt/acme/cuiliangblog/cert.pem;#证书路径
    ssl_certificate_key  /opt/acme/cuiliangblog/key.pem;#密钥路径
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    location / {
        proxy_set_header Host  $http_host;
        proxy_pass http://127.0.0.1:8080;
    }
}
# 访问统计
server {
    listen 443 ssl http2;
    server_name  umami.cuiliangblog.cn;
    charset utf-8;
    ssl_certificate    /opt/acme/cuiliangblog/cert.pem;#证书路径
    ssl_certificate_key  /opt/acme/cuiliangblog/key.pem;#密钥路径
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    #add_header Content-Security-Policy "default-src 'self' umami.cuiliangblog.cn 'unsafe-inline' 'unsafe-eval' blob: data: ;";
    #add_header X-Xss-Protection "1;mode=block";
    #add_header X-Content-Type-Options nosniff;
    #add_header Content-Security-Policy "frame-ancestors 'self' {http://127.0.0.1;";
    #add_header Access-Control-Allow-Origin '*';
    #add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
    #add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';
    #if ($request_method = 'OPTIONS') {
    #    return 204;
    #}
    location / {
        proxy_set_header Host  $http_host;
        proxy_set_header X-real-ip $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://127.0.0.1:8015;
        add_header Content-Security-Policy "upgrade-insecure-requests;connect-src *";
    }
}
# 博客网站API接口
server {
    listen       443 ssl http2;
    server_name  api.cuiliangblog.cn;
    ssl_certificate    /opt/acme/cuiliangblog/cert.pem;#证书路径
    ssl_certificate_key  /opt/acme/cuiliangblog/key.pem;#密钥路径
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    location / {
          #include uwsgi_params;
          #uwsgi_pass 127.0.0.1:8010;
          #uwsgi_ignore_client_abort on;
          proxy_pass http://127.0.0.1:8010;
    }
}
# www博客站点配置
server {
    listen       443 ssl http2;
    server_name  www.cuiliangblog.cn;
    ssl_certificate    /opt/acme/cuiliangblog/cert.pem;#证书路径
    ssl_certificate_key  /opt/acme/cuiliangblog/key.pem;#密钥路径
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    gzip on;
    gzip_buffers 4 16k;
    gzip_comp_level 6;
    gzip_vary on;
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;
    location /static/file/sitemap.txt {
        proxy_pass http://127.0.0.1:8010;
        #include uwsgi_params;
        #uwsgi_pass 127.0.0.1:8010;
    }
    location /sitemap.xml {
        proxy_pass http://127.0.0.1:8010;
        #include uwsgi_params;
        #uwsgi_pass 127.0.0.1:8010;
        #uwsgi_ignore_client_abort on;
    }
    location /feed.xml {
        proxy_pass http://127.0.0.1:8010;
        #include uwsgi_params;
        #uwsgi_pass 127.0.0.1:8010;
        #uwsgi_ignore_client_abort on;
    }
    location /.well-known/microsoft-identity-association.json {
        proxy_set_header Host  $http_host;
        proxy_pass http://127.0.0.1:8010/static/file/PC-microsoft-identity-association.json;
    }
    location ~* /detail\/(section|article)/(.*) {
        set $kind $1;
        set $content_id $2;
        if ( $http_user_agent ~* "Baiduspider|Baiduspider-render|Googlebot|360Spider|Bingbot|Sogou Spider|Yahoo! Slurp China|Yahoo! Slurp|twitterbot|facebookexternalhit|rogerbot|embedly|quora link preview|showyoubot|outbrain|pinterest|slackbot|vkShare|W3C_Validator" ) {
                #return 555 "http://127.0.0.1:8000/robots/$kind/$content_id";
            proxy_pass http://127.0.0.1:8010/robots/$kind/$content_id;
            #uwsgi_pass 127.0.0.1:8010/robots/$kind/$content_id;
         }
            #rewrite ^(.*) http://127.0.0.1:8000/$1 break;
              #break;
            #}
        proxy_pass http://127.0.0.1:8011;
    }
    location / {
        proxy_set_header Host  $http_host;
        proxy_pass http://127.0.0.1:8011;
    }
}
# m博客站点配置
server {
    listen       443 ssl http2;
    server_name  m.cuiliangblog.cn;
    ssl_certificate    /opt/acme/cuiliangblog/cert.pem;#证书路径
    ssl_certificate_key  /opt/acme/cuiliangblog/key.pem;#密钥路径
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    gzip on;
    gzip_buffers 4 16k;
    gzip_comp_level 6;
    gzip_vary on;
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;
    location / {
        proxy_set_header Host  $http_host;
        proxy_pass http://127.0.0.1:8012;
    }
    location /.well-known/microsoft-identity-association.json {
        proxy_set_header Host  $http_host;
        proxy_pass http://127.0.0.1:8010/static/file/M-microsoft-identity-association.json;
    }
}
# 泛域名跳转
server {
    listen       443 ssl http2;
    listen       80;
    server_name  *.cuiliangblog.cn cuiliangblog.cn;
    return 301 https://www.cuiliangblog.cn;
}